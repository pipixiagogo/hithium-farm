(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[27],{oe8E:function(e,t,a){"use strict";var l=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=l(a("bx4M"));a("2qtc");var i=l(a("kLXV")),d=l(a("jehZ"));a("5NDa");var o=l(a("5rEg"));a("g9YV");var u=l(a("wCAj"));a("+L6B");var c=l(a("2/Rp"));a("giR+");var s=l(a("fyUT"));a("+BJd");var f=l(a("mr32"));a("miYZ");var p=l(a("tsqr")),m=l(a("p0pE")),h=l(a("2Taf")),v=l(a("vZ4D")),g=l(a("l4Ni")),y=l(a("ujKo")),E=l(a("MhPg"));a("OaEy");var b=l(a("2fM7"));a("y8nQ");var w,x,S,D,I=l(a("Vl3Y")),C=n(a("q1tI")),N=a("MuoO"),k=l(a("zHco")),L=l(a("xNuS")),T=a("+n12"),z=I.default.Item,M=b.default.Option,O=(w=I.default.create(),x=(0,N.connect)(function(e){var t=e.device,a=e.loading;return{device:t,selectCompanyList:t.selectCompanyList,tableLoading:a.effects["device/getTableData"]}}),w(S=x((D=function(e){function t(){var e,a;(0,h.default)(this,t);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return a=(0,g.default)(this,(e=(0,y.default)(t)).call.apply(e,[this].concat(n))),a.state={searchData:{page:1,pageSize:10,online:!1,orderField:"lastOfflineTime",order:-1},visible:!1,isExport:!1},a.getList=function(){var e=a.props.dispatch,t=a.state.searchData;e({type:"device/getTableData",payload:(0,m.default)({},t)})},a.showTotal=function(e,t){return C.default.createElement("span",null,"\u663e\u793a\u7b2c".concat(t[0],"\u5230\u7b2c ").concat(t[1]," \u6761\u8bb0\u5f55\uff0c\u603b\u5171 ").concat(e," \u6761\u8bb0\u5f55"))},a.handleReset=function(e){e.preventDefault();var t=a.props.form;t.resetFields(),a.handleSubmit(e)},a.handleTableChange=function(e,t,l){var n=a.state.searchData,r=l.order&&l.columnKey||"",i=l.order?"descend"===l.order?-1:1:"";a.setState({searchData:(0,m.default)({},n,{page:e.current,pageSize:e.pageSize,orderField:r,order:i})},function(){a.getList()})},a.handleSubmit=function(e){e.preventDefault();var t=a.props.form,l=a.state.searchData;t.validateFields(["offlineDay","factoryCode"],function(e,t){if(!e){var n=(0,m.default)({},l,t,{page:1});a.setState({searchData:n},function(){a.getList()})}})},a.handleExport=function(e){e.preventDefault();var t=a.props,l=t.form,n=t.dispatch,r=a.state.searchData;l.validateFields(["fileName"],function(e,t){if(!e){var l=(0,m.default)({},t,r,{online:"false"});delete l.page,delete l.pageSize,a.setState({isExport:!0}),n({type:"device/exportData",payload:(0,m.default)({},l)}).then(function(e){e.success?(p.default.loading("\u6587\u4ef6\u5bfc\u51fa\u4e2d\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\uff01",0),a.timer=setInterval(function(){n({type:"common/getExportResult",payload:{recordId:e.data.id}}).then(function(e){e.success?e.data.filename&&(clearInterval(a.timer),p.default.destroy(),a.setState({visible:!1,isExport:!1},function(){var t={fileName:e.data.filename,originName:e.data.originName,token:localStorage.getItem("huihan-token")};document.getElementById("tempiframe").src="/excel/download?".concat((0,T.jsonToQueryString)(t))})):(a.setState({isExport:!1}),clearInterval(a.timer),p.default.destroy())})},2e3)):a.setState({isExport:!1})})}})},a}return(0,E.default)(t,e),(0,v.default)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dispatch,a=e.selectCompanyList;this.getList(),a.length||t({type:"device/getSelectCompanyList"})}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer),p.default.destroy()}},{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,l=t.tableLoading,n=t.device,h=t.selectCompanyList,v=n.tableList,g=n.tablePage,y=this.state,E=y.visible,w=y.isExport,x={labelCol:{span:4},wrapperCol:{span:14}},S=[{title:"\u5e8f\u53f7",dataIndex:"id",width:100,render:function(e,t,a){return(g.current-1)*g.pageSize+a+1}},{title:"RDB-SN",width:200,dataIndex:"rdbsn",sorter:!0,render:function(e){return C.default.createElement(L.default,{tooltip:!0,lines:1},e)}},{title:"\u5728\u7ebf\u72b6\u6001",width:150,dataIndex:"online",render:function(e){return C.default.createElement("span",null,e?C.default.createElement(f.default,{color:"green"},"\u5728\u7ebf"):C.default.createElement(f.default,null,"\u79bb\u7ebf"))}},{title:"\u6ce8\u518c\u65f6\u95f4",width:200,dataIndex:"registDate",sorter:!0},{title:"\u6700\u540e\u4e00\u6b21\u79bb\u7ebf\u65f6\u95f4",width:200,dataIndex:"lastOfflineTime",sorter:!0},{title:"\u9879\u76eePN",width:200,dataIndex:"itemPn",render:function(e){return e||"--"}},{title:"\u7c7b\u578b",width:100,dataIndex:"category",render:function(e){return e||"--"}},{title:"\u5ba2\u6863\u5730\u533a",width:200,dataIndex:"area",render:function(e){return e||"--"}},{title:"\u57fa\u7ad9\u5730\u533a",width:200,dataIndex:"geographicPosition",render:function(e){return C.default.createElement("span",null,e&&e.cityName?e.cityName:"--")}},{title:"\u5382\u5546\u540d\u79f0",width:200,dataIndex:"factoryName",render:function(e){return C.default.createElement(L.default,{tooltip:!0,lines:1},e||"--")}}];return C.default.createElement(k.default,null,C.default.createElement(r.default,{bordered:!1,bodyStyle:{padding:0}},C.default.createElement(I.default,{layout:"inline",hideRequiredMark:!0,onSubmit:this.handleSubmit},C.default.createElement(z,null,a("offlineDay")(C.default.createElement(s.default,{className:"wd-200",placeholder:"\u8bbe\u5907\u79bb\u7ebf\u5929\u6570\uff0c\u9ed8\u8ba4\u8d85\u8fc71\u5929",min:1,max:1e4,step:1,precision:0}))),C.default.createElement(z,null,a("factoryCode")(C.default.createElement(b.default,{className:"wd-100",dropdownMatchSelectWidth:!1,placeholder:"\u5382\u5546\u540d\u79f0"},h.map(function(e){return C.default.createElement(M,{key:e.id,value:e.id},e.factoryName)})))),C.default.createElement(z,null,C.default.createElement(c.default,{type:"primary",htmlType:"submit"},"\u641c\u7d22")),C.default.createElement(z,null,C.default.createElement(c.default,{onClick:this.handleReset},"\u91cd\u7f6e")),C.default.createElement("br",null),C.default.createElement(z,null,C.default.createElement(c.default,{type:"primary",onClick:function(){e.setState({visible:!0})}},"\u8bbe\u5907\u5bfc\u51fa"))),C.default.createElement(u.default,{className:"mt-20",rowKey:function(e){return e.id},dataSource:v,pagination:(0,m.default)({},g,{showSizeChanger:!0,showQuickJumper:!0,showTotal:this.showTotal}),columns:S,onChange:this.handleTableChange,loading:l,scroll:{x:1750,y:500}}),C.default.createElement(i.default,{title:"Excel\u6587\u4ef6\u5bfc\u51fa",visible:E,onOk:v.length?this.handleExport:function(){e.setState({visible:!1})},onCancel:function(){clearInterval(e.timer),p.default.destroy(),e.setState({visible:!1,isExport:!1})},maskClosable:!1,okButtonProps:{disabled:w},destroyOnClose:!0},v.length?C.default.createElement(I.default,null,C.default.createElement(z,(0,d.default)({},x,{label:"\u6587\u4ef6\u540d",extra:"\u8bf7\u524d\u5f80\u6d4f\u89c8\u5668\u4e0b\u8f7d\u5185\u5bb9\u9875\u67e5\u770bExcel\u5bfc\u51fa\u72b6\u6001"}),a("fileName",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u4ef6\u540d"}],initialValue:"\u8bbe\u5907\u79bb\u7ebf\u7edf\u8ba1"})(C.default.createElement(o.default,{placeholder:"\u8bf7\u8f93\u5165\u6587\u4ef6\u540d"})))):C.default.createElement("div",null,"\u8be5\u6761\u4ef6\u4e0b\u4e0d\u5b58\u5728\u8bbe\u5907\uff0c\u8bf7\u91cd\u65b0\u7b5b\u9009\uff01"))))}}]),t}(C.PureComponent),S=D))||S)||S),P=O;t.default=P}}]);