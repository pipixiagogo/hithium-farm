(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[40],{YtTi:function(e,t,a){"use strict";var l=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var d=l(a("bx4M")),o=l(a("jehZ"));a("g9YV");var r=l(a("wCAj"));a("iQDF");var u=l(a("+eQT"));a("+L6B");var i=l(a("2/Rp"));a("5NDa");var c=l(a("5rEg"));a("/zsF");var s=l(a("PArb"));a("miYZ");var f=l(a("tsqr")),m=l(a("p0pE")),p=l(a("2Taf")),h=l(a("vZ4D")),v=l(a("l4Ni")),g=l(a("ujKo")),E=l(a("rlhR")),y=l(a("MhPg"));a("2qtc");var T=l(a("kLXV"));a("OaEy");var b=l(a("2fM7"));a("y8nQ");var w,D,M,C,Y=l(a("Vl3Y")),x=n(a("q1tI")),S=a("MuoO"),k=l(a("wd/R")),N=l(a("zHco")),L=l(a("xNuS")),O=a("+n12"),R=Y.default.Item,F=b.default.Option,H=T.default.confirm,I=(w=Y.default.create(),D=(0,S.connect)(function(e){var t=e.updateLog,a=e.loading;return{updateLog:t,tableLoading:a.effects["updateLog/updateBatchList"]}}),w(M=D((C=function(e){function t(e){var a;(0,p.default)(this,t),a=(0,v.default)(this,(0,g.default)(t).call(this,e)),a.getList=function(){var e=a.props.dispatch,t=a.state.searchData;e({type:"updateLog/updateBatchList",payload:(0,m.default)({},t)})},a.showCancleModal=function(e){var t=a.props.dispatch,l=a.state.searchData,n=(0,E.default)(a);H({title:"\u786e\u5b9a\u53d6\u6d88\u5347\u7ea7\u8bbe\u5907\u4e48?",okText:"\u786e\u8ba4",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){t({type:"device/cancelUpdate",payload:{deviceName:e,version:l.version,type:l.type,batchCode:l.batchCode}}).then(function(e){1===e.code&&n.getList()})},onCancel:function(){}})},a.showCancleModalMore=function(){var e=a.state,t=e.selectedRowKeys,l=e.searchData,n=a.props.dispatch,d=(0,E.default)(a);t.length?H({title:"\u786e\u5b9a\u53d6\u6d88\u5347\u7ea7\u8fd9\u4e9b\u8bbe\u5907\u4e48?",okText:"\u786e\u8ba4",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){n({type:"updateLog/cancelUpdateMore",payload:{deviceNames:t.join(","),version:l.version,type:l.type,batchCode:l.batchCode}}).then(function(e){1===e.code&&d.setState({selectedRowKeys:[]},function(){d.getList()})})},onCancel:function(){}}):f.default.info("\u8bf7\u5148\u9009\u62e9\u8981\u53d6\u6d88\u5347\u7ea7\u7684\u8bbe\u5907\uff01")},a.showAgainModal=function(e){var t=a.props.dispatch,l=a.state.searchData,n=(0,E.default)(a);H({title:"\u786e\u5b9a\u518d\u6b21\u5347\u7ea7\u8bbe\u5907\u4e48?",okText:"\u786e\u8ba4",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){t({type:"device/updateAgain",payload:{deviceName:e,batchCode:l.batchCode}}).then(function(e){1===e.code&&n.getList()})},onCancel:function(){}})},a.showAgainModalMore=function(){var e=a.state,t=e.selectedRowKeys,l=e.searchData,n=a.props.dispatch,d=(0,E.default)(a);t.length?H({title:"\u786e\u5b9a\u518d\u6b21\u5347\u7ea7\u8fd9\u4e9b\u8bbe\u5907\u4e48?",okText:"\u786e\u8ba4",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){n({type:"updateLog/againUpdateMore",payload:{deviceNames:t.join(","),batchCode:l.batchCode}}).then(function(e){1===e.code&&d.setState({selectedRowKeys:[]},function(){d.getList()})})},onCancel:function(){}}):f.default.info("\u8bf7\u5148\u9009\u62e9\u8981\u518d\u6b21\u5347\u7ea7\u7684\u8bbe\u5907\uff01")},a.onSelectChange=function(e){a.setState({selectedRowKeys:e})},a.showTotal=function(e,t){return x.default.createElement("span",null,"\u663e\u793a\u7b2c".concat(t[0],"\u5230\u7b2c ").concat(t[1]," \u6761\u8bb0\u5f55\uff0c\u603b\u5171 ").concat(e," \u6761\u8bb0\u5f55"))},a.handleReset=function(e){e.preventDefault();var t=a.props.form;t.resetFields(),a.handleSubmit(e)},a.handleTableChange=function(e){var t=a.state.searchData;a.setState({searchData:(0,m.default)({},t,{page:e.current,pageSize:e.pageSize})},function(){a.getList()})},a.handleSubmit=function(e){e.preventDefault();var t=a.props.form,l=a.state.searchData;t.validateFields(function(e,t){if(!e){var n=(0,m.default)({},l,t,{page:1,startTimeFrom:t.startTimeFrom&&t.startTimeFrom.format("YYYY-MM-DD HH:mm:ss"),startTimeTo:t.startTimeTo&&t.startTimeTo.format("YYYY-MM-DD HH:mm:ss"),endTimeFrom:t.endTimeFrom&&t.endTimeFrom.format("YYYY-MM-DD HH:mm:ss"),endTimeTo:t.endTimeTo&&t.endTimeTo.format("YYYY-MM-DD HH:mm:ss")});a.setState({searchData:n},function(){a.getList()})}})},a.handleExport=function(e){e.preventDefault();var t=a.props,l=t.form,n=t.dispatch,d=a.state.searchData;l.validateFields(["fileName"],function(e,t){if(!e){var l=(0,m.default)({},t,d);delete l.page,delete l.pageSize,a.setState({isExport:!0}),n({type:"device/exportUpgradeData",payload:(0,m.default)({},l)}).then(function(e){e?(f.default.loading("\u6587\u4ef6\u5bfc\u51fa\u4e2d\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\uff01",0),a.timer=setInterval(function(){n({type:"common/getExportResult",payload:{recordId:e.data.id}}).then(function(e){e.success?e.data.filename&&(clearInterval(a.timer),f.default.destroy(),a.setState({visible:!1,isExport:!1},function(){var t={fileName:e.data.filename,originName:e.data.originName,token:localStorage.getItem("huihan-token")};document.getElementById("tempiframe").src="/excel/download?".concat((0,O.jsonToQueryString)(t))})):(a.setState({isExport:!1}),clearInterval(a.timer),f.default.destroy())})},2e3)):a.setState({isExport:!1})})}})};var l=e.location;return a.state={selectedRowKeys:[],searchData:{page:1,pageSize:10,version:decodeURIComponent(l.query.version),batchCode:l.query.batchCode,type:l.query.type},showMore:!1,visible:!1,isExport:!1},a}return(0,y.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){this.getList()}},{key:"render",value:function(){var e=this,t=this.props,a=t.form,l=a.getFieldDecorator,n=a.getFieldValue,f=t.updateLog,p=t.tableLoading,h=f.updateList,v=f.updatePage,g=this.state,E=g.visible,y=g.isExport,w=this.state,D=w.selectedRowKeys,M=w.showMore,C=w.searchData,S={selectedRowKeys:D,onChange:this.onSelectChange},O={labelCol:{span:4},wrapperCol:{span:14}},H=[{title:"\u5e8f\u53f7",dataIndex:"deviceName",width:100,render:function(e,t,a){return(v.current-1)*v.pageSize+a+1}},{title:"RDB SN",dataIndex:"rdbsn",render:function(e){return x.default.createElement(L.default,{tooltip:!0,lines:1},e)}},{title:"\u4e0b\u8f7d\u72b6\u6001",dataIndex:"downloadMsg",width:100,render:function(e){return e||"--"}},{title:"\u4f20\u8f93\u72b6\u6001",dataIndex:"transMsg",width:100,render:function(e){return e||"--"}},{title:"\u5347\u7ea7\u72b6\u6001",dataIndex:"upgradeMsg",width:100,render:function(e){return e||"--"}},{title:"\u5f00\u59cb\u65f6\u95f4",width:200,dataIndex:"startTime",render:function(e){return e||"--"}},{title:"\u5b8c\u6210\u65f6\u95f4",dataIndex:"recordTime",width:200,render:function(e){return e||"--"}},{title:"\u64cd\u4f5c",fixed:"right",width:150,align:"center",render:function(t,a){return x.default.createElement("span",null,x.default.createElement("a",{disabled:a.status>4,onClick:function(){return e.showCancleModal(a.deviceName)}},"\u53d6\u6d88"),x.default.createElement(s.default,{type:"vertical"}),x.default.createElement("a",{disabled:a.status<6||9===a.status,onClick:function(){return e.showAgainModal(a.deviceName)}},"\u518d\u6b21\u5347\u7ea7"))}}],I=n("startTimeFrom"),B=n("startTimeTo"),j=function(e){return B?(0,k.default)(e).valueOf()>=(0,k.default)(B).valueOf():(0,k.default)(e).valueOf()>=(0,k.default)(new Date).valueOf()},K=function(e){return(0,k.default)(e).valueOf()<=(0,k.default)(I).valueOf()},z=n("endTimeFrom"),q=n("endTimeTo"),A=function(e){return q?(0,k.default)(e).valueOf()>=(0,k.default)(q).valueOf():(0,k.default)(e).valueOf()>=(0,k.default)(new Date).valueOf()},U=function(e){return(0,k.default)(e).valueOf()<=(0,k.default)(z).valueOf()};return x.default.createElement(N.default,null,x.default.createElement(d.default,{bordered:!1,bodyStyle:{padding:0}},x.default.createElement(Y.default,{layout:"inline",hideRequiredMark:!0,onSubmit:this.handleSubmit},x.default.createElement(R,null,l("rdbsn")(x.default.createElement(c.default,{className:"wd-100",placeholder:"RDB-SN"}))),x.default.createElement(R,null,l("status")(x.default.createElement(b.default,{className:"wd-100",dropdownMatchSelectWidth:!1,placeholder:"\u72b6\u6001"},x.default.createElement(F,{value:1},"\u4e0b\u8f7d\u4e2d"),x.default.createElement(F,{value:2},"\u4e0b\u8f7d\u5b8c\u6210"),"BMU"===C.type?x.default.createElement(F,{value:3},"\u4f20\u8f93\u4e2d"):null,"BMU"===C.type?x.default.createElement(F,{value:4},"\u4f20\u8f93\u5b8c\u6210"):null,"RDB"===C.type?x.default.createElement(F,{value:5},"\u5347\u7ea7\u4e2d"):null,x.default.createElement(F,{value:6},"\u5347\u7ea7\u6210\u529f"),x.default.createElement(F,{value:7},"\u5347\u7ea7\u5931\u8d25")))),x.default.createElement(R,null,x.default.createElement(i.default,{type:"primary",htmlType:"submit"},"\u641c\u7d22")),x.default.createElement(R,null,x.default.createElement(i.default,{onClick:this.handleReset},"\u91cd\u7f6e")),x.default.createElement(R,null,x.default.createElement(i.default,{onClick:function(){e.setState({showMore:!M})}},M?"\u9690\u85cf":"\u66f4\u591a")),x.default.createElement("br",null),M?x.default.createElement("span",null,x.default.createElement(R,null,l("startTimeFrom",{rules:[{type:"object"}]})(x.default.createElement(u.default,{format:"YYYY-MM-DD HH:mm:ss",disabledDate:j,showTime:!0,placeholder:"\u5f00\u59cb\u5347\u7ea7-\u5f00\u59cb\u65f6\u95f4"}))),x.default.createElement("span",{className:"line"},"-"),x.default.createElement(R,null,l("startTimeTo",{rules:[{type:"object"}]})(x.default.createElement(u.default,{format:"YYYY-MM-DD HH:mm:ss",disabledDate:I&&K,showTime:!0,placeholder:"\u5f00\u59cb\u5347\u7ea7-\u7ed3\u675f\u65f6\u95f4"}))),x.default.createElement(R,null,l("endTimeFrom",{rules:[{type:"object"}]})(x.default.createElement(u.default,{format:"YYYY-MM-DD HH:mm:ss",disabledDate:A,showTime:!0,placeholder:"\u5b8c\u6210\u5347\u7ea7-\u5f00\u59cb\u65f6\u95f4"}))),x.default.createElement("span",{className:"line"},"-"),x.default.createElement(R,null,l("endTimeTo",{rules:[{type:"object"}]})(x.default.createElement(u.default,{format:"YYYY-MM-DD HH:mm:ss",disabledDate:z&&U,showTime:!0,placeholder:"\u5b8c\u6210\u5347\u7ea7-\u7ed3\u675f\u65f6\u95f4"}))),x.default.createElement("br",null)):"",x.default.createElement("br",null),x.default.createElement(R,null,x.default.createElement(i.default,{type:"primary",onClick:function(){e.showCancleModalMore("RDB")}},"\u6279\u91cf\u53d6\u6d88")),x.default.createElement(R,null,x.default.createElement(i.default,{type:"primary",onClick:function(){e.showAgainModalMore("RDB")}},"\u6279\u91cf\u518d\u6b21\u5347\u7ea7")),x.default.createElement(R,null,x.default.createElement(i.default,{type:"primary",onClick:function(){e.setState({visible:!0})}},"\u5347\u7ea7\u65e5\u5fd7\u5bfc\u51fa"))),x.default.createElement(r.default,{className:"mt-20",rowKey:function(e){return e.deviceName},dataSource:h,pagination:(0,m.default)({},v,{showSizeChanger:!0,showQuickJumper:!0,showTotal:this.showTotal}),columns:H,onChange:this.handleTableChange,loading:p,scroll:{x:1200,y:500},rowSelection:S}),x.default.createElement(T.default,{title:"Excel\u6587\u4ef6\u5bfc\u51fa",visible:E,onOk:h.length?this.handleExport:function(){e.setState({visible:!1})},onCancel:function(){e.setState({visible:!1,isExport:!1})},maskClosable:!1,okButtonProps:{disabled:y},destroyOnClose:!0},h.length?x.default.createElement(Y.default,null,x.default.createElement(R,(0,o.default)({},O,{label:"\u6587\u4ef6\u540d",extra:"\u8bf7\u524d\u5f80\u6d4f\u89c8\u5668\u4e0b\u8f7d\u5185\u5bb9\u9875\u67e5\u770bExcel\u5bfc\u51fa\u72b6\u6001"}),l("fileName",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u4ef6\u540d"}],initialValue:"\u5347\u7ea7\u65e5\u5fd7\u5bfc\u51fa"})(x.default.createElement(c.default,{placeholder:"\u8bf7\u8f93\u5165\u6587\u4ef6\u540d"})))):x.default.createElement("div",null,"\u8be5\u6761\u4ef6\u4e0b\u4e0d\u5b58\u5728\u8bbe\u5907\uff0c\u8bf7\u91cd\u65b0\u7b5b\u9009\uff01"))))}}]),t}(x.PureComponent),M=C))||M)||M),B=I;t.default=B}}]);